<!DOCTYPE html>
<html lang="en" class="light-style layout-navbar-fixed" dir="ltr" data-theme="theme-default"
  data-assets-path="../static/assets/" data-template="vertical-menu-template">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <title>Leaf Detection</title>
  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../static/assets/img/branding/leaf chili.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />

  <!-- Icons -->
  <link rel="stylesheet" href="../static/assets/vendor/fonts/materialdesignicons.css" />
  <link rel="stylesheet" href="../static/assets/vendor/fonts/fontawesome.css" />

  <!-- Core CSS -->
  <link rel="stylesheet" href="../static/assets/vendor/css/rtl/core.css" />
  <link rel="stylesheet" href="../static/assets/vendor/css/rtl/theme-default.css" />
  <link rel="stylesheet" href="../static/assets/css/demo.css" />

  <!-- Custom Styling -->
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8f9fa;
    }

    h2 {
      text-align: center;
      color: #6c757d;
    }

    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 25px;
      background: #ffffff;
    }

    .info-box {
      background: #f9f9fc;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      padding: 20px;
      text-align: center;
    }

    .info-box h5 {
      font-size: 1.2rem;
      font-weight: 600;
      color: #666cff;
    }

    .info-box p {
      font-size: 0.9rem;
      margin-bottom: 0.4rem;
      color: #444; /* lebih gelap biar jelas */
    }

    #imageDaun {
      width: 100%;
      max-width: 280px;
      height: auto;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      margin-top: 10px;
    }

    .diagnosis-box {
      background: #f1f0ff;
      border-left: 5px solid #666cff;
      padding: 15px;
      border-radius: 12px;
      margin: 20px 0;
      text-align: center;
    }

    .diagnosis-box h4 {
      margin: 0 0 8px;
      color: #666cff;
      font-weight: 700;
    }

    .info-section {
      background-color: #f9fbfd;
      padding: 20px;
      border-radius: 12px;
      border-left: 5px solid #666cff;
      box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .info-section h4 {
      margin-bottom: 15px;
      font-weight: 600;
      color: #666cff;
    }

    .btn-primary {
      background-color: #666cff;
      border-color: #666cff;
      padding: 12px 28px;
      border-radius: 30px;
      font-weight: 600;
      letter-spacing: 0.5px;
      box-shadow: 0 3px 8px rgba(111, 66, 193, 0.3);
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      background-color: #5a32a3;
      border-color: #5a32a3;
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(111, 66, 193, 0.45);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
      margin-top: 15px;
    }

    table th,
    table td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    table th {
      background: #666cff;
      color: #fff;
    }

    @media (max-width: 768px) {
      .row {
        flex-direction: column;
      }

      #imageDaun {
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <div class="layout-page">
        <div class="content-wrapper">
          <div class="container-xxl flex-grow-1 container-p-y">

            <!-- Container -->
            <div class="card">
              <div class="row g-4 align-items-start">
                <!-- Kolom kiri: info + gambar -->
                <div class="col-md-4">
                  <div class="info-box">
                    <h5 id="current-name">{{pred_output}}</h5>
                    <p id="current-date"></p>
                    <p id="current-time"></p>
                    <img id="imageDaun"
                      src="{{ url_for('static', filename=user_image.split('static/')[1]) }}"
                      alt="User Image" />
                  </div>
                </div>

                <!-- Kolom kanan -->
                <div class="col-md-8">
                  <!-- Box hasil diagnosa -->
                  <div class="diagnosis-box">
                    <h4>ðŸŒ¿ Hasil Diagnosa</h4>
                    <p><b>{{pred_output}}</b></p>
                  </div>

                  <!-- Info Perawatan -->
                  <div class="info-section">
                    <h4><b>Perawatan:</b></h4>
                    <h6 style="text-align: justify;">
                      Tanaman cabai dalam kondisi <b>sehat</b>. Tidak ditemukan gejala penyakit atau kerusakan pada daun. 
                      Pertahankan kondisi ini dengan perawatan rutin seperti penyiraman cukup, pemupukan seimbang, dan 
                      pengendalian hama secara preventif.
                    </h6>

                    <h5 style="color:#666cff; margin-top:20px;"><b>Perawatan Tanaman Sehat (SOP Lapangan)</b></h5>
                    <table>
                      <tr>
                        <th>Kegiatan</th>
                        <th>Waktu / Frekuensi</th>
                        <th>Keterangan</th>
                      </tr>
                      <tr>
                        <td>Penyiraman</td>
                        <td>1â€“2 kali sehari</td>
                        <td>Disesuaikan dengan kelembaban tanah</td>
                      </tr>
                      <tr>
                        <td>Pemupukan NPK seimbang</td>
                        <td>Setiap 2 minggu</td>
                        <td>Dosis sesuai umur tanaman</td>
                      </tr>
                      <tr>
                        <td>Pengendalian gulma</td>
                        <td>Rutin (1 minggu sekali)</td>
                        <td>Membersihkan area sekitar tanaman</td>
                      </tr>
                      <tr>
                        <td>Pemeriksaan daun</td>
                        <td>Setiap hari</td>
                        <td>Deteksi dini adanya bercak atau hama</td>
                      </tr>
                    </table>
                  </div>
                </div>
              </div>

              <!-- Tombol Simpan -->
              <div class="row mt-4">
                <div class="d-flex align-items-center justify-content-center">
                  <form id="formRiwayat" action="/save" method="POST">
                    <input type="hidden" name="name" value="" />
                    <input type="hidden" name="tanggal" value="" />
                    <input type="hidden" name="waktu" value="" />
                    <input type="hidden" name="gambar" value="" />
                    <button type="submit" class="btn btn-primary">Simpan Riwayat</button>
                  </form>
                </div>
              </div>
            </div>
            <!-- / Container -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Core JS -->
  <script src="../static/assets/vendor/libs/jquery/jquery.js"></script>
  <script src="../static/assets/vendor/libs/popper/popper.js"></script>
  <script src="../static/assets/vendor/js/bootstrap.js"></script>

  <!-- Script untuk tanggal & form -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const formRiwayat = document.getElementById("formRiwayat");
      const imageDaun = document.getElementById("imageDaun");

      var today = new Date();
      var dateOptions = { year: "numeric", month: "long", day: "numeric" };
      var timeOptions = { hour: "2-digit", minute: "2-digit", second: "2-digit" };

      var dateString = today.toLocaleDateString("id-ID", dateOptions);
      var timeString = today.toLocaleTimeString("id-ID", timeOptions);

      document.getElementById("current-date").textContent = "Tanggal: " + dateString;
      document.getElementById("current-time").textContent = "Waktu: " + timeString;

      formRiwayat.addEventListener("submit", async (e) => {
        e.preventDefault();

        const iname = document.querySelector("input[name=name]");
        const itanggal = document.querySelector("input[name=tanggal]");
        const iwaktu = document.querySelector("input[name=waktu]");
        const igambar = document.querySelector("input[name=gambar]");

        const name = document.getElementById("current-name").textContent.trim();

        const response = await fetch(imageDaun.src);
        const blob = await response.blob();
        const reader = new FileReader();

        reader.readAsDataURL(blob);

        const base64Promise = new Promise((resolve, reject) => {
          reader.onloadend = () => resolve(reader.result);
          reader.onerror = reject;
        });

        const base64data = await base64Promise;

        if (base64data) {
          iname.value = name;
          itanggal.value = dateString;
          iwaktu.value = timeString;
          igambar.value = base64data;

          formRiwayat.submit();
        }
      });
    });
  </script>
</body>
</html>
